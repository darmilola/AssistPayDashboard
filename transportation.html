<!--
=========================================================
* Argon Dashboard - v1.2.0
=========================================================
* Product Page: https://www.creative-tim.com/product/argon-dashboard


* Copyright  Creative Tim (http://www.creative-tim.com)
* Coded by www.creative-tim.com



=========================================================
* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Start your development with a Dashboard for Bootstrap 4.">
  <meta name="author" content="Creative Tim">
  <title>Assist Dashboard</title>
  <!-- Favicon -->
  <link rel="icon" href="assets/img/brand/favicon.png" type="image/png">
  <!-- Fonts -->
  <!-- Main CSS-->
  <link href="./assets/css/main.css" rel="stylesheet" media="all">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
  <!-- Icons -->
  <link rel="stylesheet" href="assets/vendor/nucleo/css/nucleo.css" type="text/css">
  <link rel="stylesheet" href="assets/vendor/@fortawesome/fontawesome-free/css/all.min.css" type="text/css">
  <!-- Argon CSS -->
  <link rel="stylesheet" href="assets/css/argon.css?v=1.2.0" type="text/css">
  <script src="./assets/js/loader.js"></script>
  <link rel="stylesheet" href="./assets/css/loader.css"/>
  <link rel="stylesheet" href="./assets/css/dropdown.css"/>  

</head>

<body>
<!-- Sidenav -->
<nav class="sidenav navbar navbar-vertical  fixed-left  navbar-expand-xs navbar-light bg-white" id="sidenav-main">
  <div class="scrollbar-inner">
    <!-- Brand -->
    <div class="sidenav-header  align-items-center">
      <a class="navbar-brand" href="javascript:void(0)">
        <img src="assets/img/brand/assistlogo.jpg" class="navbar-brand-img" alt="">
      </a>
    </div>
    <div class="navbar-inner">
      <!-- Collapse -->
      <div class="collapse navbar-collapse" id="sidenav-collapse-main">
        <!-- Nav items -->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" href="index.html">
              <i class="ni ni-tv-2 text-primary"></i>
              <span class="nav-link-text">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="transportation.html">
              <i class="ni ni-pin-3 text-primary"></i>
              <span class="nav-link-text">Transportation</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="loans.html">
              <i class="ni ni-single-02 text-yellow"></i>
              <span class="nav-link-text">Loans</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="verification.html">
              <i class="ni ni-circle-08 text-pink"></i>
              <span class="nav-link-text">Verification</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="login.html">
              <i class="ni ni-send text-dark"></i>
              <span class="nav-link-text">Log Out</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</nav>
  <!-- Main content -->
  <div class="main-content" id="panel">
    <!-- Header -->
    <!-- Header -->
    <div class="header bg-primary pb-6">
      <div class="container-fluid">
        <div class="header-body">
          <div class="row align-items-center py-4">
            <div class="col-lg-6 col-7">
              <h6 class="h2 text-white d-inline-block mb-0">Transportation</h6>
            </div>
            <div class="col-lg-6 col-5 text-right">
              <a href="#" class="btn btn-sm btn-neutral" id="add-new-route-button">Add New Route</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Page content -->
    <div class="container-fluid mt--6">

     <!-- drivers Starts here ---->
      <div class="row" id="drivers_list">
        <div class="col">
          <div class="card">
            <!-- Card header -->
            <div class="card-header border-0">
              <h3 class="mb-0">Routes</h3>
            </div>
            <!-- Light table -->
            <div class="table-responsive">
              <table class="table align-items-center table-flush">
                <thead class="thead-light">
                  <tr>
                    <th scope="col" class="sort" data-sort="name">Type</th>
                    <th scope="col" class="sort" data-sort="budget">From</th>
                    <th scope="col" class="sort" data-sort="status">To</th>
                    <th scope="col">Fare</th>
                    <th scope="col" class="sort" data-sort="completion">Phone</th>
                    <th scope="col" class="sort" data-sort="completion">Available Seats</th>
                  </tr>
                </thead>
                <tbody class="list" id="transport_list">
                 
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- drivers ends here ---->

      

       
       <!-- bookings Starts here ---->
       <div class="row" id="booking_list_root" style="display: none;">
        <div class="col">
          <div class="card">
            <!-- Card header -->
            <div class="card-header border-0" style="display: flex; justify-content: space-between;">
              <h3 class="mb-0">Bookings</h3>
              <h3 class="mb-0" id="dismiss_bookings" style="color: blue;">Dismiss</h3>
            </div>
            <!-- Light table -->
            <div class="table-responsive">
              <table class="table align-items-center table-flush">
                <thead class="thead-light">
                  <tr>
                    <th scope="col" class="sort" data-sort="email">Email</th>
                    <th scope="col" class="sort" data-sort="phone">Contact Phone</th>
                    <th scope="col" class="sort" data-sort="status">Payment Status</th>
                  </tr>
                </thead>
                <tbody class="list" id="booking_list">
                 
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- bookings ends here ---->

      <!--- Add New Route Page ---->

      <div class="page-wrapper bg-dark p-t-100 p-b-50" id="add-new-route" style="display: none">
        <div class="wrapper wrapper--w900">
          <div class="cardm cardm-6">
            <div class="cardm-heading">
              <h2 class="title" id="add_route_button">Add New Route</h2>
            </div>
            <div class="cardm-body">
              <form method="POST">
                <div class="form-row">
                  <div class="name">From</div>
                  <select id="from">
                    <option selected value="0">Select From</option>
                    <option value="Lagos">Lagos</option>
                    <option value="Abuja">Abuja</option>
                    <option value="Kano">Kano</option>
                  </select>
                </div>


              <div class="form-row">
                  <div class="name">To</div>
                  <select id="to">
                    <option selected value="0">Select To</option>
                    <option value="Lagos">Lagos</option>
                    <option value="Abuja">Abuja</option>
                    <option value="Kano">Kano</option>
                  </select>
                </div>


                <div class="form-row">
                  <div class="name">Type</div>
                  <select id="type">
                    <option selected value="0">Select Type</option>
                    <option value="bus">Bus</option>
                    <option value="car">Car</option>
                  </select>
                </div>

                <div class="form-row">
                  <div class="name">Fare</div>
                  <div class="value">
                    <input class="input--style-6" id="fare" type="number">
                  </div>
                </div>

                <div class="form-row">
                  <div class="name">Seats</div>
                  <div class="value">
                    <input class="input--style-6" id="seats" type="number">
                  </div>
                </div>

                <div class="form-row">
                  <div class="name">Contact Phone</div>
                  <div class="value">
                    <input class="input--style-6" id="phone" type="number">
                  </div>
                </div>
              </form>
            </div>
            <div class="cardm-footer">
              <button class="btn btn--radius-2 btn--blue-2" id="add-route" type="submit">Save</button>
              <button class="btn btn--radius-2 btn--blue-2" id="cancel-add" type="submit">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    </div>








    <!-- Footer -->
    </div>
  </div>
  <!-- Argon Scripts -->
  <!-- Core -->
  <script src="assets/vendor/jquery/dist/jquery.min.js"></script>
  <script src="assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/js-cookie/js.cookie.js"></script>
  <script src="assets/vendor/jquery.scrollbar/jquery.scrollbar.min.js"></script>
  <script src="assets/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js"></script>
  <!-- Argon JS -->
  <script src="assets/js/argon.js?v=1.2.0"></script>
  <script src="assets/js/transportation.js"></script>


  <script>
   loadPage()

   $('#add-route').click(function(event) {
    event.preventDefault();
    CreateTransport()
   
});


   function CreateTransport(){
        
      
      if($("#from").val() === '0' || !$("#to").val() === '0' || !$("#type").val() === '0' || !$("#fare").val() || !$("#phone").val() || !$("#seats").val()){
            
            alert("Provide all required input")
        
      }else{ 

        Loader.open()
      
      from = $("#from").val()
      to   = $("#to").val()
      type = $("#type").val()
      fare = $("#fare").val()
      phone = $("#phone").val()
      seats = $("#seats").val()  
      
      const createRouteUrl = "https://protected-garden-55416.herokuapp.com/public/api/drivers/create"

      const data = {
        mType:type,
        mFrom:from,
        mTo:to,
        seats:seats,
        phone:phone,
        fare:fare
      }

      $.ajax({
        url:createRouteUrl,
        type:'POST',
        data:data,
        success: function(result){
              Loader.close()
              alert("Route Created Successfully")
              $('#drivers_list').toggle();
              $('#add-new-route').toggle();
              loadPage()
                    
          },
        error: function(error){
          Loader.close()
          alert("Error Occured please try again")
        }
      })
    }

    }
  

    function loadPage(){
      Loader.open()
      const transportUrl = "https://protected-garden-55416.herokuapp.com/public/api/drivers/buses/all";;
      $.ajax({
        url:transportUrl,
        type:'POST',
        success: function(result){
              Loader.close()
             var strHTML = '';
             result["data"].forEach(element => {
              strHTML += "<tr><th scope='row'><div class='media align-items-center'><div class='media-body'> <span class='name mb-0 text-sm'>"+element.mType+"</span>"
                       + " </div></div></th><td class='budget'>"+element.mFrom+"</td><td><span class='badge badge-dot mr-4'><i class='bg-warning'></i> <span class='status'>"+element.mTo+"</span>"
                     + "  </span> </td><td><div class='d-flex align-items-center'><span class='completion mr-2'>"+element.fare+"</span> </div> </td>"
                    +"  <td class='text-left'>"+ element.phone +"</div></td><td class='text-left'>"+element.seats+"<div class='dropdown'>"
                    +"    <a class='btn btn-sm btn-icon-only text-light' href='#' role='button' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'> <i class='fas fa-ellipsis-v'></i>"
                   +"     </a><div class='dropdown-menu dropdown-menu-right dropdown-menu-arrow'><a class='dropdown-item' onClick=getBookings("+element.id+")>"+"View Bookings"+"</a>"
                   +"       <a class='dropdown-item' href='#'>"+ "Delete Route" +"</a> </div> </div></td></tr>";

                    });
                    $("#transport_list").empty()
                    $("#transport_list").append(strHTML)
             
        },
        error: function(error){
          Loader.close()
        }
      })

    }

   
    

      function getBookings(transportId){
           Loader.open()
      
      const transportBookingsUrl = "https://protected-garden-55416.herokuapp.com/public/api/drivers/buses/bookings"

      const data = {
        transport_id:transportId
      }

      $.ajax({
        url:transportBookingsUrl,
        type:'POST',
        data:data,
        success: function(result){
              Loader.close()
             var strHTML = '';
             console.log(result["data"])
             result["data"].forEach(element => {
               strHTML += "<tr><th scope='row'><div class='media align-items-center'><div class='media-body'> <span class='name mb-0 text-sm'>"+element.userId+"</span>"
                       + " </div></div></th><td class='budget'>"+element.contactPhone+"</td><td><span class='badge badge-dot mr-4'><i class='bg-warning'></i> <span class='status'>"+element.paymentStatus+"</span>"
                       + "  </span> </td></tr>";

                    });
                    $("#booking_list").empty()
                    $("#booking_list").append(strHTML)
                    $('#booking-list').toggle();
                    $('#booking_list_root').toggle();
                    $('#transport_list').toggle();
                    $('#add-new-route-button').toggle();
                    $('#drivers_list').toggle();
                    
          },
        error: function(error){
          Loader.close()
          alert("No Bookings Available")
        }
      })
    }
      


  </script>

</body>

</html>