<!--
=========================================================
* Argon Dashboard - v1.2.0
=========================================================
* Product Page: https://www.creative-tim.com/product/argon-dashboard


* Copyright  Creative Tim (http://www.creative-tim.com)
* Coded by www.creative-tim.com



=========================================================
* The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
-->
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Start your development with a Dashboard for Bootstrap 4.">
    <meta name="author" content="Creative Tim">
    <title>Assist Dashboard</title>
    <!-- Favicon -->
    <link rel="icon" href="assets/img/brand/favicon.png" type="image/png">
    <!-- Fonts -->
    <!-- Main CSS-->
    <link href="./assets/css/main.css" rel="stylesheet" media="all">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700">
    <!-- Icons -->
    <link rel="stylesheet" href="assets/vendor/nucleo/css/nucleo.css" type="text/css">
    <link rel="stylesheet" href="assets/vendor/@fortawesome/fontawesome-free/css/all.min.css" type="text/css">
    <!-- Argon CSS -->
    <link rel="stylesheet" href="assets/css/argon.css?v=1.2.0" type="text/css">
    <script src="./assets/js/loader.js"></script>
    <link rel="stylesheet" href="./assets/css/loader.css"/>
    <link rel="stylesheet" href="./assets/css/dropdown.css"/>

    <script>
        email = sessionStorage.getItem("isLoggedIn")
        if(email === null){
            window.location.href = "login.html";
        }

        $( "#logout_item" ).click(function() {
            sessionStorage.removeItem("isLoggedIn")
            window.location.href = "login.html"
        });


    </script>

</head>

<body>
<!-- Sidenav -->
<nav class="sidenav navbar navbar-vertical  fixed-left  navbar-expand-xs navbar-light bg-white" id="sidenav-main">
    <div class="scrollbar-inner">
        <!-- Brand -->
        <div class="sidenav-header  align-items-center">
            <a class="navbar-brand" href="javascript:void(0)">
                <img src="assets/img/brand/assistlogo.jpg" class="navbar-brand-img" alt="...">
            </a>
        </div>
        <div class="navbar-inner">
            <!-- Collapse -->
            <div class="collapse navbar-collapse" id="sidenav-collapse-main">
                <!-- Nav items -->
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="ni ni-tv-2 text-primary"></i>
                            <span class="nav-link-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="transportation.html">
                            <i class="ni ni-pin-3 text-primary"></i>
                            <span class="nav-link-text">Transportation</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="loans.html">
                            <i class="ni ni-single-02 text-yellow"></i>
                            <span class="nav-link-text">Loans</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="verification.html">
                            <i class="ni ni-circle-08 text-pink"></i>
                            <span class="nav-link-text">Verification</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Withdrawals.html">
                            <i class="ni ni-circle-08 text-pink"></i>
                            <span class="nav-link-text">Withdrawals</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Refunds.html">
                            <i class="ni ni-circle-08 text-pink"></i>
                            <span class="nav-link-text">Refund</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="adminpanel.html">
                            <i class="ni ni-pin-3 text-primary"></i>
                            <span class="nav-link-text">Admin Panel</span>
                        </a>
                    </li>
                    <li class="nav-item"id="logout_item">
                        <a class="nav-link" href="login.html">
                            <i class="ni ni-pin-3 text-primary"></i>
                            <span class="nav-link-text">Log Out</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>
<!-- Main content -->
<div class="main-content" id="panel">
    <!-- Header -->
    <!-- Header -->
    <div class="header bg-primary pb-6">
        <div class="container-fluid">
            <div class="header-body">
                <div class="row align-items-center py-4">
                    <div class="col-lg-6 col-7">
                        <h6 class="h2 text-white d-inline-block mb-0">Admin Panel</h6>
                    </div>
                    <div class="col-lg-6 col-5 text-right">
                        <a href="#" class="btn btn-sm btn-neutral" id="add-new-admin-button">Add New Admin</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Page content -->
    <div class="container-fluid mt--6">

        <!-- admin Starts here ---->
        <div class="row" id="admins_list">
            <div class="col">
                <div class="card">
                    <!-- Card header -->
                    <div class="card-header border-0">
                        <h3 class="mb-0">Admins</h3>
                    </div>
                    <!-- Light table -->
                    <div class="table-responsive">
                        <table class="table align-items-center table-flush">
                            <thead class="thead-light">
                            <tr>
                                <th scope="col" class="sort" data-sort="name">Email</th>
                                <th scope="col" class="sort" data-sort="name">Name</th>
                            </tr>
                            </thead>
                            <tbody class="list" id="admin_list">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- drivers ends here ---->






        <!--- Add New Route Page ---->

        <div class="page-wrapper bg-dark p-t-100 p-b-50" id="add-new-admin-root" style="display: none">
            <div class="wrapper wrapper--w900">
                <div class="cardm cardm-6">
                    <div class="cardm-heading">
                        <h2 class="title">Add New Admin</h2>
                    </div>
                    <div class="cardm-body">
                        <form method="POST">
                            <div class="form-row">
                                <div class="name">Email</div>
                                <div class="value">
                                    <input class="input--style-6" id="email" type="text">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="cardm-footer">
                        <button class="btn btn--radius-2 btn--blue-2" id="add-admin" type="submit">Save</button>
                        <button class="btn btn--radius-2 btn--blue-2" id="cancel-add" type="submit">Cancel</button>
                    </div>
                </div>
            </div>
        </div>







    <!-- Footer -->
</div>
</div>
<!-- Argon Scripts -->
<!-- Core -->
<script src="assets/vendor/jquery/dist/jquery.min.js"></script>
<script src="assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/js-cookie/js.cookie.js"></script>
<script src="assets/vendor/jquery.scrollbar/jquery.scrollbar.min.js"></script>
<script src="assets/vendor/jquery-scroll-lock/dist/jquery-scrollLock.min.js"></script>
<!-- Argon JS -->
<script src="assets/js/argon.js?v=1.2.0"></script>
<script src="assets/js/transportation.js"></script>


<script>
    loadPage()

    $('#add-admin').click(function(event) {
        event.preventDefault();
        CreateAdmin()

    });


    function CreateAdmin(){


        if(!$("#email").val()){

            alert("Provide required input")

        }else{

            Loader.open()
            email = $("#email").val()

            const createUrl = "https://gentle-mountain-10412.herokuapp.com/public/api/users/admin/assign"

            const data = {
                email:email,
                role:"admin"
            }

            console.log(data)

            $.ajax({
                url:createUrl,
                type:'POST',
                data:data,
                success: function(result){
                    Loader.close()
                    alert("Admin Added Successfully")
                    $('#admins_list').toggle();
                    $('#add-new-admin-root').toggle();
                    loadPage()

                },
                error: function(error){
                    Loader.close()
                    alert("Error Occurred please check the Email and try again")
                }
            })
        }

    }


    function removeAdmin(userEmail){

            alert(userEmail)
            Loader.open()
            const createUrl = "https://gentle-mountain-10412.herokuapp.com/public/api/users/admin/assign"



            const data = {
                email:userEmail,
                role:"none"
            }

            alert(data)

            $.ajax({
                url:createUrl,
                type:'POST',
                data:data,
                success: function(result){
                    Loader.close()
                    alert("Admin Removed Successfully")
                    loadPage()

                },
                error: function(error){
                    Loader.close()
                    alert("Error Occurred please check the Email and try again")
                }
            })

    }


    function loadPage(){
        Loader.open()
        const adminUrl = "https://gentle-mountain-10412.herokuapp.com/public/api/users/admin/get";
        $.ajax({
            url:adminUrl,
            type:'POST',
            success: function(result){
                console.log(result)
                Loader.close()
                var strHTML = '';
                result["data"].forEach(element => {
                    strHTML += "<tr><th scope='row'><div class='media align-items-center'><div class='media-body'> <span class='name mb-0 text-sm'>"+element.email+"</span>"
                        + " </div></div></th>"
                        +"  <td class='text-left'>"+element.firstname+" "+element.lastname+"<div class='dropdown'>"
                        +"    <a class='btn btn-sm btn-icon-only text-light' href='#' role='button' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'> <i class='fas fa-ellipsis-v'></i>"
                        +"     </a><div class='dropdown-menu dropdown-menu-right dropdown-menu-arrow'>"
                        +"       <a class='dropdown-item'href="+'https://gentle-mountain-10412.herokuapp.com/public/api/users/admin/remove/?email='+element.email+"&"+"role="+"none"+">"+ "Remove Admin" +"</a> </div> </div></td></tr>";

                });
                $("#admin_list").empty()
                $("#admin_list").append(strHTML)

            },
            error: function(error){
                Loader.close()
            }
        })

    }


    $('#add-new-admin-button').click(function(event) {
        event.preventDefault();
        $('#admins_list').toggle();
        $('#add-new-admin-root').toggle();
    });

    $('remove-admin').click(function(event) {
        event.preventDefault();


    });





    $('#cancel-add').click(function(event) {
        event.preventDefault();
        $('#admins_list').toggle();
        $('#add-new-admin-root').toggle();
    });





</script>

</body>

</html>